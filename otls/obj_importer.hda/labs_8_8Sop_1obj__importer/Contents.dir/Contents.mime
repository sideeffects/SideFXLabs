MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY"

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename=".OPfallbacks"
Content-Type: application/external-reference

.OPfallbacks

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename=".OPdummydefs"
Content-Type: application/external-reference

.OPdummydefs

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="node_type"
Content-Type: text/plain

Sop

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot.init"
Content-Type: text/plain

type = labs::obj_importer
matchesdef = 0

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot.def"
Content-Type: text/plain

sopflags sopflags = 
comment ""
position -0.525413 -3.27312
connectornextid 0
flags =  lock off model off template off footprint off xray off bypass off display off render off highlight off unload off savedata off compress on colordefault on exposed on
outputsNamed3
{
}
inputsNamed3
{
}
inputs
{
}
stat
{
  create -1
  modify -1
  author christoss@oxbow
  access 0777
}
color UT_Color RGB 0.8 0.8 0.8 
delscript ""
exprlanguage hscript
end

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot.userdata"
Content-Type: text/plain

{
	"___Version___":{
		"type":"string",
		"value":"___EXTERNAL___"
	}
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/mesh_materials.init"
Content-Type: text/plain

type = labs::quickmaterial::2.1
matchesdef = 1

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/mesh_materials.def"
Content-Type: text/plain

sopflags sopflags = 
comment ""
position -0.108372 2.96062
connectornextid 2
flags =  lock off model off template off footprint off xray off bypass off display off render off highlight off unload off savedata off compress on colordefault on exposed on
outputsNamed3
{
0 "output1"
}
inputsNamed3
{
1 	clean_materialpaths 1 1 "input1"
}
inputs
{
0 	clean_materialpaths 0 1
}
stat
{
  create -1
  modify -1
  author Paul@DESKTOP-PAFFS1R
  access 0777
}
color UT_Color RGB 0.8 0.8 0.8 
delscript ""
exprlanguage hscript
end

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/mesh_materials.parm"
Content-Type: text/plain

{
version 0.8
switchoriginal	[ 0	locks=0 ]	(	0	)
usemikkt	[ 0	locks=0	autoscope=0 ]	(	"on"	)
mMaterialEntries	[ 0	locks=0	autoscope=0 ]	(	1	)
materialdefinition_1	[ 0	locks=0 ]	(	"0"	)
materialname_1	[ 0	locks=0 ]	(	/Copper_Blurry	)
groupselection_1	[ 0	locks=0 ]	(	@shop_materialpath=/Copper_Blurry	)
sepparm1	[ 0	locks=0 ]	(	)
folder0_1	[ 0	locks=0 ]	(	0	)
basecolorfolder_1	[ 0	locks=0 ]	(	0	)
principledshader_basecolor_texture_1	[ 0	locks=0 ]	(	""	)
principledshader_basecolor_1	[ 0	locks=0 ]	(	1	0.99220001697540283	0.98820000886917114	)
opacityfolder_1	[ 0	locks=0 ]	(	0	)
principledshader_opaccolor_texture_1	[ 0	locks=0 ]	(	""	)
normalfolder_1	[ 0	locks=0 ]	(	0	)
principledshader_baseNormal_texture_1	[ 0	locks=0 ]	(	""	)
principledshader_baseNormal_flipY_1	[ 0	locks=0 ]	(	"off"	)
principledshader_roundedEdge_enable_1	[ 0	locks=0 ]	(	"off"	)
principledshader_roundedEdge_radius_1	[ 0	locks=0 ]	(	0	)
principledshader_roundedEdge_mode_1	[ 0	locks=0 ]	(	0	)
roughnessfolder_1	[ 0	locks=0 ]	(	0	)
principledshader_rough_texture_1	[ 0	locks=0 ]	(	""	)
principledshader_rough_1	[ 0	locks=0 ]	(	0.65200000000000002	)
principledshader_ior_1	[ 0	locks=0 ]	(	1.1000000000000001	)
folder0_1_4	[ 0	locks=0 ]	(	0	)
principledshader_occlusion_texture_1	[ 0	locks=0 ]	(	""	)
principledshader_occlusion_textureIntensity_1	[ 0	locks=0 ]	(	1	)
metallicfolder_1	[ 0	locks=0 ]	(	0	)
principledshader_metallic_texture_1	[ 0	locks=0 ]	(	""	)
principledshader_metallic_1	[ 0	locks=0 ]	(	0	)
folder0_1_2	[ 0	locks=0 ]	(	0	)
matcapshader_basecolor_texture_1	[ 0	locks=0 ]	(	$HH/pic/MatCap/OilClay.pic	)
matcapshader_use_texture_alpha_1	[ 0	locks=0 ]	(	"off"	)
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/mesh_materials.userdata"
Content-Type: text/plain

{
	"___Version___":{
		"type":"string",
		"value":"___EXTERNAL___"
	},
	"___toolcount___":{
		"type":"string",
		"value":"2"
	},
	"___toolid___":{
		"type":"string",
		"value":"gamedev::sop_sop_quickmaterial"
	}
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/file1.init"
Content-Type: text/plain

type = file
matchesdef = 0

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/file1.def"
Content-Type: text/plain

sopflags sopflags = 
comment ""
position -0.108372 4.96062
connectornextid 1
flags =  lock off model off template off footprint off xray off bypass off display off render off highlight off unload off savedata off compress on colordefault on exposed on
outputsNamed3
{
0 "output1"
}
inputsNamed3
{
}
inputs
{
}
stat
{
  create -1
  modify -1
  author paula@DESKTOP-5213MPP
  access 0777
}
color UT_Color RGB 0.9 0.8 0.55 
delscript ""
exprlanguage hscript
end

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/file1.chn"
Content-Type: text/plain

{
    channel index {
      lefttype = extend
      righttype = extend
      flags = 0
      segment { length = 0 expr = $FF-ch(\"f1\") }
    }
    channel reload {
      lefttype = extend
      righttype = extend
      flags = 0
      segment { length = 0 expr = ch(\"../reload\") }
    }
  }

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/file1.parm"
Content-Type: text/plain

{
version 0.8
filemode	[ 0	locks=0 ]	(	"read"	)
file	[ 0	locks=0 ]	(	`chs(\"../sObjFile\")`	)
reload	[ 0	locks=0 ]	(	[ reload	0 ] 	)
objpattern	[ 0	locks=0 ]	(	*	)
geodatapath	[ 0	locks=0 ]	(	""	)
missingframe	[ 0	locks=0 ]	(	"empty"	)
loadtype	[ 0	locks=0 ]	(	"full"	)
packedviewedit	[ 0	locks=0 ]	(	"unchanged"	)
viewportlod	[ 0	locks=0 ]	(	"box"	)
packexpanded	[ 0	locks=0 ]	(	"on"	)
delayload	[ 0	locks=0 ]	(	"off"	)
mkpath	[ 0	locks=0 ]	(	"on"	)
cachesize	[ 0	locks=0 ]	(	0	)
prefetch	[ 0	locks=0 ]	(	"off"	)
f	[ 0	locks=0 ]	(	1	24	)
index	[ 0	locks=0 ]	(	[ index	0 ] 	)
wrap	[ 0	locks=0 ]	(	"cycle"	)
retry	[ 0	locks=0 ]	(	0	)
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/file1.userdata"
Content-Type: text/plain

{
	"___Version___":{
		"type":"string",
		"value":"___EXTERNAL___"
	}
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/output0.init"
Content-Type: text/plain

type = output
matchesdef = 0

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/output0.def"
Content-Type: text/plain

sopflags sopflags = 
comment ""
position -0.108372 1.39152
connectornextid 1
flags =  lock off model off template off footprint off xray off bypass off display on render on highlight off unload off savedata off compress on colordefault on exposed on
outputsNamed3
{
}
inputsNamed3
{
0 	mesh_materials 0 1 "input1"
}
inputs
{
0 	mesh_materials 0 1
}
stat
{
  create -1
  modify -1
  author paula@DESKTOP-5213MPP
  access 0777
}
color UT_Color RGB 0.8 0.8 0.8 
delscript ""
exprlanguage hscript
end

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/output0.parm"
Content-Type: text/plain

{
version 0.8
outputidx	[ 0	locks=0 ]	(	0	)
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/output0.userdata"
Content-Type: text/plain

{
	"___Version___":{
		"type":"string",
		"value":"___EXTERNAL___"
	}
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/null1.init"
Content-Type: text/plain

type = null
matchesdef = 0

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/null1.def"
Content-Type: text/plain

sopflags sopflags = 
comment ""
position -3.01811 2.68294
connectornextid 2
flags =  lock off model off template off footprint off xray off bypass off display off render off highlight off unload off savedata off compress on colordefault on exposed on
outputsNamed3
{
1 "output1"
}
inputsNamed3
{
0 	clean_materialpaths 1 1 "input1"
}
inputs
{
0 	clean_materialpaths 0 1
}
stat
{
  create -1
  modify -1
  author paula@DESKTOP-5213MPP
  access 0777
}
color UT_Color RGB 0.6 0.7 0.77 
delscript ""
exprlanguage hscript
end

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/null1.parm"
Content-Type: text/plain

{
version 0.8
copyinput	[ 0	locks=0 ]	(	"off"	)
cacheinput	[ 0	locks=0 ]	(	"off"	)
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/null1.userdata"
Content-Type: text/plain

{
	"___Version___":{
		"type":"string",
		"value":"___EXTERNAL___"
	}
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/clean_materialpaths.init"
Content-Type: text/plain

type = python
matchesdef = 0

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/clean_materialpaths.def"
Content-Type: text/plain

sopflags sopflags = 
comment ""
position -0.108372 3.96062
connectornextid 2
flags =  lock off model off template off footprint off xray off bypass off display off render off highlight off unload off savedata off compress on colordefault on exposed on
outputsNamed3
{
1 "output1"
}
inputsNamed3
{
0 	file1 0 1 "input1"
}
inputs
{
0 	file1 0 1
}
stat
{
  create -1
  modify -1
  author michaelb@boswell
  access 0777
}
color UT_Color RGB 0.8 0.8 0.8 
delscript ""
exprlanguage hscript
end

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/clean_materialpaths.parm"
Content-Type: text/plain

{
version 0.8
python	[ 0	locks=0 ]	(	"import re
node = hou.pwd()
geo = node.geometry()

matattrname = \"shop_materialpath\"

def cleanName(nodename):
    nodename = re.sub(r\"[^a-zA-Z0-9_/\\-.]+\", \"_\", nodename)
    if nodename[0] == '-' or nodename[0] == '.':
        nodename = \"_\" + nodename
    if re.match(r\"^[0-9]+$\", nodename):
        nodename = \"_\" + nodename
    return nodename

def cleanMatPaths(geo):
    prims = hou.Geometry.prims(geo)
    for prim in prims:
        matpath = hou.Prim.attribValue(prim, matattrname)
        matpath = cleanName(matpath)
        hou.Prim.setAttribValue(prim, matattrname, matpath)
    
if hou.Geometry.findPrimAttrib(geo, matattrname) != None:
    cleanMatPaths(geo)"	)
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/clean_materialpaths.userdata"
Content-Type: text/plain

{
	"___Version___":{
		"type":"string",
		"value":"___EXTERNAL___"
	}
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/python1.init"
Content-Type: text/plain

type = python
matchesdef = 0

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/python1.def"
Content-Type: text/plain

sopflags sopflags = 
comment ""
position -3.01811 1.39152
connectornextid 2
flags =  lock off model off template off footprint off xray off bypass off display off render off highlight off unload off savedata off compress on colordefault on exposed on
outputsNamed3
{
1 "output1"
}
inputsNamed3
{
0 	null1 1 1 "input1"
}
inputs
{
0 	null1 0 1
}
stat
{
  create -1
  modify -1
  author paula@DESKTOP-5213MPP
  access 0777
}
color UT_Color RGB 0.8 0.8 0.8 
delscript ""
exprlanguage hscript
end

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/python1.parm"
Content-Type: text/plain

{
version 0.8
python	[ 0	locks=0 ]	(	"import os
import re

def cleanName(nodename):
    nodename = re.sub(r\"[^a-zA-Z0-9_/\\-.]+\", \"_\", nodename)
    if nodename[0] == '-' or nodename[0] == '.':
        nodename = \"_\" + nodename
    if re.match(r\"^[0-9]+$\", nodename):
        nodename = \"_\" + nodename
    return nodename
    
def findInSubdirectory(filename, subdirectory):
    for root, dirs, names in os.walk(subdirectory, followlinks=True):
        if filename in names:
            return os.path.join(root, filename)


def LoadMTL():
    node = hou.pwd()
    geo = node.geometry()

    # Read the filename from an houdini parameter
    obj_path = os.path.normpath(node.parent().parm(\"sObjFile\").evalAsString())
    obj_dir, obj_name = os.path.split(obj_path)

    if node.parent().parm(\"bCustomMTLFile\").evalAsInt() == 1:
        mtl_file = node.parent().parm(\"sCustomMTL\").evalAsString() 
    else:
        mtl_file = os.path.join(obj_dir, \".\".join(obj_name.split(\".\")[:-1])+ \".mtl\")

    if not os.path.isfile(mtl_file):
        raise hou.NodeWarning(\"No MTL found has been found that matches the description in the .obj!\")

    attributes = set() # Keep a list of the attributes we read
    mtls = [] # Extracted materials
    mid = -1 # Current material index while readin
    mnames = [] # Keep a list of the material names we read
    with open( mtl_file ) as f:
        lines = f.readlines() # read all the lines
        for line in lines:
            comment_index = line.find('#') # strip comments
            if comment_index!=-1:
                line = line[0:comment_index-1]

            tokens = [x for x in line.strip().split(' ') if x != \"\"]
            
            if len(tokens) < 2 or tokens[0].startswith('#'): #skip invalid lines
                continue

            if tokens[0] == \"newmtl\": #newmtl token, create a new entry
                mid = mid +1
                tokens[1] = cleanName(tokens[1])
                mtls.append( {tokens[0]:[tokens[1]]} )
                attributes.add(tokens[0])
                mnames.append(tokens[1])
            elif mid>=0: #a material value line, add it.
                mtls[mid][tokens[0]] = tokens[1:]
                attributes.add(tokens[0])

          
    # Register all the point attributes
    # The data types are harcoded here, and the extra info is also registered
    for a in attributes:
        if a in [\"Kd\"]:
            geo.addAttrib(hou.attribType.Point, a, [0.0,0.0,0.0])
        if a in [\"Ni\"]:
            geo.addAttrib(hou.attribType.Point, a, 0.0)
        elif a in [\"map_Kd\",\"map_Ks\", \"map_d\", \"newmtl\", \"map_bump\"]:
            geo.addAttrib(hou.attribType.Point, a, \"\")

    # Add a point per material and set all the attribute values
    # Each point on this SOP holds all the material values
    for mtl in mtls:
        point = geo.createPoint()
        for a,av in sorted(mtl.items()):
            if a == \"newmtl\":
                point.setAttribValue(a, av[-1] )
            if a in [\"Kd\"]:
                point.setAttribValue(a, [float(av[0]),float(av[1]),float(av[2])])
            if a in [\"Ni\"]:
                point.setAttribValue(a, float(av[0]))
            
            
            elif a in [\"map_Kd\",\"map_Ks\", \"map_d\", \"map_bump\"]:
                av_dir, av_name = os.path.split(av[-1])
                output =  findInSubdirectory(av_name, obj_dir)
                if output != None:
                    point.setAttribValue(a, output)

LoadMTL()"	)
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot/python1.userdata"
Content-Type: text/plain

{
	"___Version___":{
		"type":"string",
		"value":"___EXTERNAL___"
	}
}

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot.order"
Content-Type: text/plain

6
mesh_materials
file1
output0
null1
clean_materialpaths
python1

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY
Content-Disposition: attachment; filename="hdaroot.net"
Content-Type: text/plain

1

--HOUDINIMIMEBOUNDARY0xD3ADD339-0x00000F49-0x56B122C9-0x00000001HOUDINIMIMEBOUNDARY--
